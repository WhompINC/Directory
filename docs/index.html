<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SDU Shield Explorer</title>
  <style>
    /* CSS styles here remain unchanged */
  </style>
</head>
<body>
  <div class="grid">
    <div id="sidebar">
      <h3>üìÅ File Tree</h3>
      <ul id="path-tree"></ul>
      <div id="env-toggle-group">
        <button class="env-btn" id="env-local">LOCAL</button>
        <button class="env-btn" id="env-virtual">VIRTUAL</button>
      </div>
    </div>
    <div id="header">
      <button id="back-btn">‚óÄ</button>
      <button id="forward-btn">‚ñ∂</button>
      <div id="path-display"></div>
      <input id="search" placeholder="Search..." />
      <button id="search-btn">üîç</button>
    </div>
    <div id="controls"></div>
    <div id="viewer">
      <div id="doc-view">Select a folder or file‚Ä¶</div>
      <button id="copy-btn">Copy</button>
    </div>
  </div>
  <script>
    const treeData = {
      "C:": {
        "Reports": { "summary.txt": "file", "analysis.md": "file", "data.json": "file" },
        "Scripts": { "build.py": "file", "deploy.sh": "file", "config.ini": "file" },
        "Source": { "main.c": "file", "util.h": "file", "util.c": "file" },
        "README.md": "file"
      },
      "VIRTUAL:": {
        "VirtualProject": {
          "docs": { "overview.md": "file" },
          "src": { "app.py": "file" }
        }
      }
    };

    let env = localStorage.getItem("env") || "LOCAL";
    let current = localStorage.getItem("lastPath") || (env === "LOCAL" ? "C:" : "VIRTUAL:");
    let hist = [], pos = -1;

    const treeRoot = document.getElementById("path-tree"),
          pathDisp = document.getElementById("path-display"),
          backBtn = document.getElementById("back-btn"),
          fwdBtn = document.getElementById("forward-btn"),
          envLocal = document.getElementById("env-local"),
          envVirtual = document.getElementById("env-virtual"),
          searchBtn = document.getElementById("search-btn"),
          searchEl = document.getElementById("search"),
          viewer = document.getElementById("viewer"),
          docView = document.getElementById("doc-view"),
          copyBtn = document.getElementById("copy-btn"),
          header = document.getElementById("header");

    function updateNav() {
      backBtn.disabled = pos <= 0;
      fwdBtn.disabled = pos >= hist.length - 1;
      backBtn.classList.toggle("disabled", backBtn.disabled);
      fwdBtn.classList.toggle("disabled", fwdBtn.disabled);
    }

    function pushHist(p) {
      hist = hist.slice(0, pos + 1);
      hist.push(p);
      pos++;
      updateNav();
      localStorage.setItem("lastPath", p);
    }

    backBtn.onclick = () => { if (pos > 0) navigate(hist[--pos], false); };
    fwdBtn.onclick = () => { if (pos < hist.length - 1) navigate(hist[++pos], false); };
    window.onmousedown = e => { if (e.button === 3) backBtn.click(); if (e.button === 4) fwdBtn.click(); };

    function buildTree(node, ul, prefix = "") {
      for (const key in node) {
        const li = document.createElement("li");
        li.textContent = key;
        ul.appendChild(li);

        const childUl = document.createElement("ul");
        childUl.style.display = "none";
        li.appendChild(childUl);

        if (typeof node[key] === "object") {
          li.classList.add("folder");
          li.onclick = e => {
            e.stopPropagation();
            const expanded = li.classList.toggle("expanded");
            childUl.style.display = expanded ? "block" : "none";
            navigate(prefix ? prefix + "/" + key : key);
          };
          buildTree(node[key], childUl, prefix ? prefix + "/" + key : key);
        } else {
          li.classList.add("file");
          li.onclick = e => {
            e.stopPropagation();
            navigate(prefix ? prefix + "/" + key : key);
          };
        }
      }
    }

    function navigate(path, push = true) {
      if (push) pushHist(path);
      current = path;
      pathDisp.innerHTML = "";
      path.split("/").slice(-3).forEach((seg, i) => {
        const sp = document.createElement("span");
        sp.textContent = seg;
        sp.onclick = () => navigate(path.split("/").slice(0, i + 1).join("/"));
        pathDisp.appendChild(sp);
      });

      viewer.innerHTML = "";
      docView.textContent = "";
      copyBtn.style.display = "none";

      const q = searchEl.value.trim().toLowerCase();
      const root = treeData[path.split(":")[0]];
      const parts = path.split(":")[1].split("/").filter(Boolean);
      let node = root;
      parts.forEach(p => { node = node[p]; });

      if (typeof node === "object") {
        const names = Object.keys(node);
        const list = q ? names.filter(n => n.toLowerCase().includes(q)) : names;
        list.forEach(name => {
          const full = path + (path.endsWith(":") ? "/" : "/") + name;
          const entry = node[name];
          const row = document.createElement("div");
          row.className = "file-item";
          const a = document.createElement("a");
          a.textContent = (entry === "file" ? "üìÑ " : "üìÅ ") + name;
          a.onclick = e => { e.preventDefault(); navigate(full); };
          row.appendChild(a);
          if (entry === "file") {
            const dl = document.createElement("button");
            dl.className = "download-btn";
            dl.textContent = "üì•";
            dl.onclick = () => window.open(`https://whompinc.github.io/Directory/d/${full}`, "_blank");
            row.appendChild(dl);
          }
          viewer.appendChild(row);
        });
      }

      if (!q && node === "file") {
        docView.textContent = `Contents of ${path}`;
        viewer.appendChild(docView);
        copyBtn.style.display = "inline-block";
      }
    }

    copyBtn.onclick = () => navigator.clipboard.writeText(docView.textContent);
    searchBtn.onclick = () => navigate(current);
    searchEl.oninput = () => { if (!searchEl.value) navigate(current); };
    pathDisp.onclick = () => header.classList.toggle("highlight");

    function setEnv(e) {
      env = e;
      localStorage.setItem("env", env);
      envLocal.classList.toggle("active", env === "LOCAL");
      envVirtual.classList.toggle("active", env === "VIRTUAL");
      treeRoot.innerHTML = "";
      buildTree(treeData[env], treeRoot, env);
      navigate(env === "LOCAL" ? "C:" : "VIRTUAL:");
    }

    envLocal.onclick = () => setEnv("LOCAL");
    envVirtual.onclick = () => setEnv("VIRTUAL");
    envLocal.classList.toggle("active", env === "LOCAL");
    envVirtual.classList.toggle("active", env === "VIRTUAL");

    window.onload = () => {
      treeRoot.innerHTML = "";
      buildTree(treeData[env], treeRoot, env);
      navigate(current);
    };
  </script>
</body>
</html>
